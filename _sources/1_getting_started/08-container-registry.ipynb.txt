{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "7fb9cfe0-5e31-4e69-82ad-abf62f7fa53b",
   "metadata": {},
   "source": [
    "# **Container Registry**"
   ]
  },
  {
   "attachments": {},
   "cell_type": "markdown",
   "id": "44554656-9ff1-491c-85ce-54ab7e031de2",
   "metadata": {},
   "source": [
    "The GEOAnalytics Canada Platform hosts a Container Registry to allow users to share and manage Docker images within the platform. Docker containers are especially useful for running [custom data processing pipelines](09-pipelines.html) on the platform. \n",
    "In this notebook, we will learn how to login, create a project, and finally how to push/pull Docker images within the Container Registry.\n",
    "\n",
    "## 1. Logging into the Container Registry and creating a Project\n",
    "\n",
    "1. To access the container registry follow this link: https://registry.eo4ph.geoanalytics.ca/\n",
    "   The registry can be accessed through the GEOAnalytics Canada home page by clicking on \"Container Registry\".\n",
    "   \n",
    "2. The link will take you to the container registry's homepage (see the image below). You can log in using your GEOAnalytics Canada credentials.\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "faa74567-2dfd-4973-9677-7d60df8d990e",
   "metadata": {},
   "source": [
    "<img src='../images/getting_started_images/08-container-registry-homepage.png'>"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "37c95967",
   "metadata": {},
   "source": [
    "1. Once you have accessed the container registry, you will find yourself in the Projects Tab. Click on the \"NEW PROJECT\" button (see the image below)."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "684b9fd9-70d2-4678-aa6e-022ca907ba88",
   "metadata": {},
   "source": [
    "<img src='../images/getting_started_images/08-container-registry-homepage1.png'>"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "d19590c7",
   "metadata": {},
   "source": [
    "1. Input your desired project name, and leave the Access Level as private (keep the \"Public\" box unchecked). Click \"OK\" (see the image below)."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "1b3378f1-17f0-4950-b2be-2c271e640855",
   "metadata": {},
   "source": [
    "<img src='../images/getting_started_images/08-container-registry-newproject.png'>"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "58053dc0-5fe1-42c1-a3d8-4ec8cebbf07c",
   "metadata": {},
   "source": [
    "## 2. How to link your workspace to the Container Registry"
   ]
  },
  {
   "attachments": {},
   "cell_type": "markdown",
   "id": "a8cffef1-09bd-48eb-a25f-31c9494774d6",
   "metadata": {},
   "source": [
    "Now we will use the terminal to login our Docker CLI to our Container Registry. To do this we will require our GEOAnalytics Canada username and password. \n",
    "To start, follow these steps: \n",
    "\n",
    "1. Run the command `docker login registry.eo4ph.geoanalytics.ca`\n",
    "\n",
    "2. When prompted input your GEOAnalytics Canada username and press enter.\n",
    "\n",
    "3. When prompoted input your GEOAnalytics Canada password and press enter.\n",
    "\n",
    "Now that this is done we can push or pull Docker images from our Container Registry's projects."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "d469683a-b79d-46e5-bb32-850e627ca691",
   "metadata": {},
   "source": [
    "## 3. Adding Docker Images to the Container Registry"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "1004988f-4c4f-4525-8a8b-cae214f2f58b",
   "metadata": {},
   "source": [
    "In this section we will be exploring how to add images to the container registry.\n",
    "\n",
    "We'll start by running a few commands to show how Docker works.\n",
    "\n",
    "The command below will **pull** the hello-world Docker image from the Dockerhub, if not present already, and **run** it.\n",
    "\n",
    "```bash\n",
    "docker run hello-world\n",
    "\n",
    "```"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "a759887a-ee76-49c3-80df-a96f6b7eab00",
   "metadata": {},
   "source": [
    "Now let's try pushing the hello-world image into our container registry. To do that we must rename the image from \"hello-world\" to the location of our container registry, using the `docker tag <source-img-name> <target-img-name>` command. The target image name is the registry location because we want to push the image to a private registry and not the central Docker registry. In this example I'm going to push the image to the test registry I created called 'test-123'.\n",
    "\n",
    "```bash\n",
    "docker tag hello-world registry.eo4ph.geoanalytics.ca/test-123/hello-world\n",
    "```\n",
    "Now that we have pushed the image to our container registry location, let's run the image.\n",
    "\n",
    "```bash\n",
    "docker run registry.eo4ph.geoanalytics.ca/test-123/hello-world\n",
    "```\n",
    "\n",
    "The final step is to **push** the local Docker image to our test-123 repository. This is done by executing the `docker push <img-name>` below:\n",
    "\n",
    "```bash\n",
    "docker push registry.eo4ph.geoanalytics.ca/test-123/hello-world\n",
    "```\n",
    "Now head over to the Container Registry and click on `Projects > test-123`. You will see the Docker image you just pushed added to the repository's container registry!"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "57d66c9e-7c92-44e5-93e8-738f43276d95",
   "metadata": {},
   "source": [
    "<img src='../images/getting_started_images/08-container-registry-pushed-image.png'>"
   ]
  },
  {
   "attachments": {},
   "cell_type": "markdown",
   "id": "e7c65a4f-95fc-49ec-bd1c-d576e6d42d14",
   "metadata": {},
   "source": [
    "These were a just a few Docker commands we explored, to learn all the Docker commands available, take a look at the Docker documentation and a sample Docker workflow:\n",
    "\n",
    "- https://docs.docker.com/engine/reference/run/\n",
    "- https://docker-curriculum.com\n",
    " \n",
    "***Important Note: NEVER run a Docker image you don't know about. This is a major security issue. Only run a dockerfile from a trusted page and make sure to examine its source code!***"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3.10.6 64-bit",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.6"
  },
  "vscode": {
   "interpreter": {
    "hash": "aee8b7b246df8f9039afb4144a1f6fd8d2ca17a180786b69acc140d282b71a49"
   }
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
